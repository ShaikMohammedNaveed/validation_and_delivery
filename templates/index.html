<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebook Validator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="light-theme">
    <div class="container">
        <div class="sidebar">
            <h2>Notebook Validator</h2>
            <form id="validateForm" method="POST" novalidate>
                <div class="form-group">
                    <label for="notebook_link">Google Drive/Colab Link:</label>
                    <input type="url" id="notebook_link" name="notebook_link"
                           placeholder="https://colab.research.google.com/drive/..." required>
                    <div class="invalid-feedback">
                        Please enter a valid Google Drive or Colab notebook link.
                    </div>
                    <div class="link-preview" id="linkPreview"></div>
                </div>
                <button type="submit" class="btn btn-primary">Validate</button>
            </form>
        </div>

        <div class="main-content">
            <h1>Validation Dashboard</h1>
            <div id="spinner" class="spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <span>Validating notebook...</span>
                <div class="progress-container">
                    <div class="progress">
                        <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"
                             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>

            {% if output %}
                <div class="output-section">
                    <div class="output-header">
                        <h4>Validation Results</h4>
                        <div>
                            <button class="btn-toggle" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#outputCollapse" aria-expanded="true" aria-controls="outputCollapse">
                                Toggle
                            </button>
                            <button class="btn-copy" onclick="copyOutput()">Copy</button>
                            <button class="btn-download" onclick="downloadOutput()">Download</button>
                        </div>
                    </div>
                    <div class="collapse show" id="outputCollapse">
                        <div class="output-box" id="outputContent">{{ output }}</div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="theme-toggle" onclick="toggleTheme()">üåô</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Form Validation and Spinner
        document.getElementById('validateForm').addEventListener('submit', function(event) {
            const form = event.target;
            const notebookLink = form.querySelector('#notebook_link');
            const spinner = document.getElementById('spinner');
            const progressBar = document.getElementById('progressBar');

            if (!notebookLink.value.match(/^(https?:\/\/(colab\.research\.google\.com|drive\.google\.com)\/)/)) {
                event.preventDefault();
                notebookLink.classList.add('is-invalid');
                return;
            }

            notebookLink.classList.remove('is-invalid');
            spinner.style.display = 'block';
            progressBar.parentElement.style.display = 'block';

            // Simulate download progress (for actual progress, Flask would need streaming)
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('aria-valuenow', progress);
                if (progress >= 100) clearInterval(interval);
            }, 200);
        });

        // Real-Time Link Preview
        document.getElementById('notebook_link').addEventListener('input', function() {
            this.classList.remove('is-invalid');
            const preview = document.getElementById('linkPreview');
            preview.textContent = this.value ? `Preview: ${this.value.slice(0, 50)}${this.value.length > 50 ? '...' : ''}` : '';
        });

        // Copy Output to Clipboard
        function copyOutput() {
            const output = document.getElementById('outputContent').textContent;
            navigator.clipboard.writeText(output).then(() => {
                alert('Output copied to clipboard!');
            });
        }

        // Download Output as File
        function downloadOutput() {
            const output = document.getElementById('outputContent').textContent;
            const blob = new Blob([output], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'validation_output.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Toggle Theme
        function toggleTheme() {
            const body = document.body;
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
                document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
                document.querySelector('.theme-toggle').textContent = 'üåô';
            }
        }
    </script>
</body>
</html>